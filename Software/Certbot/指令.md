## 安裝Certbot
```
sudo apt update
sudo apt install certbot -y
```

Nginx or Apache
```
# Nginx
sudo apt install python3-certbot-nginx -y

# Apache
sudo apt install python3-certbot-apache -y
```

## 憑證申請
#### HTTP Challenge
依照網頁伺服器
```
# Nginx
sudo certbot --nginx -d example.com -d www.example.com

# Apache
sudo certbot --apache -d example.com -d www.example.com
```

僅簽發憑證
```
sudo certbot certonly --webroot -w /var/www/html -d example.com -d www.example.com
```
`--webroot` 是驗證時要存放挑戰檔的目錄。

使用 Standalone（Certbot 自建一個臨時 HTTP 伺服器）
```
sudo certbot certonly --standalone -d example.com
```

使用 DNS 驗證（需在 DNS 設 TXT 記錄）：
```
sudo certbot certonly --manual --preferred-challenges dns -d example.com
```

#### DNS Challenge
EX:Cloudflare
```
sudo apt install python3-certbot-dns-cloudflare
```

Build Token(`/root/cloudflare.ini`)
```
dns_cloudflare_api_token = 你的 cloudflare api token
```

權限
```
chmod 600 /root/cloudflare.ini
```

申請
```
sudo certbot certonly \
  --dns-cloudflare \
  --dns-cloudflare-credentials /root/cloudflare.ini \
  -d example.com -d "*.example.com"
```

補:手動
```
sudo certbot certonly --manual --preferred-challenges dns -d example.com -d "*.example.com"
```
會要求在DNS TXT紀錄中新增 `_acme-challenge.example.com = 隨機字串`
## 自動續期
測試
```
sudo certbot renew --dry-run
```

手動強制
```
sudo certbot renew
```
Certbot 會自動在 `/etc/cron.d/certbot` 建立定期任務，每天檢查即將過期的憑證

## 管理
查看全部憑證
```
sudo certbot certificates
```

刪除憑證
```
sudo certbot delete --cert-name example.com
```

更新參數(電子郵件)
```
sudo certbot register --update-registration --email new@example.com
```

查看插件
```
sudo certbot plugins
```

## 環境測試
HTTP
```
sudo certbot certonly --standalone --staging -d example.com
```

Nginx
```
sudo certbot --nginx --staging -d example.com -d www.example.com
```

Webroot
```
sudo certbot certonly --webroot --staging -w /var/www/html -d example.com
```