## DNS (Domain Name System) 
### 一、 基本概念

- **定義**：網域名稱系統。負責將人類讀得懂的「網址」（如 `google.com`）翻譯成電腦讀得懂的「IP 位址」（如 `142.250.190.78`）。 (基礎只要知道這個就好)
- **角色**：網路世界的**電話簿**或**地圖導航**。
- **傳輸細節**：主要使用 **UDP Port 53**（快速查詢），大數據傳輸時也會使用 **TCP Port 53**。

### 二、 DNS 的層級與查詢流程（尋寶之旅）

當你輸入一個網址時，電腦會按順序去問路：

1. **本機快取 (Local Cache)**：電腦先翻自己的小筆記本（Hosts 檔案或之前的紀錄）。
2. **遞迴解析器 (Recursive Resolver)**：通常是你的 ISP 或 Google ($8.8.8.8$)，它會幫你跑腿去問後面的大老。
3. **根網域伺服器 (Root Server)**：指引去哪裡找 `.com`、`.tw`、`.org`。
4. **頂級網域伺服器 (TLD Server)**：例如負責 `.com` 的伺服器，指引去哪找 `google.com`。
5. **授權域名伺服器 (Authoritative Server)**：最後一站，給出最精確的 IP 位址。

### 三、 常見的 DNS 紀錄類型

在管理網域時，你會遇到這些不同功能的紀錄：

- **A 紀錄 (Address)**：最常用，將網域指向 **IPv4** 位址。
- **AAAA 紀錄**：將網域指向 **IPv6** 位址。
- **CNAME (Canonical Name)**：**別名紀錄**。讓一個網域指向另一個網域（例如將 `www.abc.com` 指向 `abc.github.io`）。
- **MX (Mail Exchange)**：指定負責該網域的**郵件伺服器**。
- **TXT**：存放文字資訊。常用於證明你是網域擁有人（Google 或 FB 驗證）。

### 四、 關鍵術語

- **TTL (Time to Live)**：**生存時間**。告訴別人的電腦這筆紀錄可以「快取」多久。
    - **TTL 短**：更改 IP 後生效快，但 DNS 伺服器壓力大。
    - **TTL 長**：解析速度快，但更改設定後需等待較長時間才會全球同步。
- **DNS 污染 (DNS Cache Poisoning)**：駭客給予錯誤的 IP 解析，將你引導至假網站（如釣魚網站）。

### 五、 常用的公共 DNS 推薦

| 供應商               | IP                                  |
| ----------------- | ----------------------------------- |
| Google Public DNS | `8.8.8.8`、`8.8.4.4`                 |
| Cloudflare DNS    | `1.1.1.1`、`1.0.0.1`                 |
| Quad9 (IBM)       | `9.9.9.10`、`149.112.112.10`         |
| Quad 101(TWNIC)   | `101.101.101.101`、`101.102.103.104` |
| HiNet DNS         | `168.95.1.1`、`168.95.192.1`         |
| OpenDNS(Cisco)    | `208.67.222.222`、`208.67.220.220`   |
TWNIC有DNS RPZ (Response Policy Zone)封鎖政策 如擔心封鎖到要需要的網頁 盡量避免使用


## 內網 DNS (Internal DNS)
### 一、 基本概念

- **定義**：運行在區域網路（LAN）內部的 DNS 服務，僅供內網裝置使用。
- **核心目的**：
    1. **內網名稱化**：不用記 `192.168.1.50`，直接輸入 `nas.home` 或 `printer.office` 就能連線。
    2. **減少對外依賴**：內網裝置互相溝通時，不需要去問公網 DNS，速度更快且更隱私。
    3. **安全性**：隱藏內部伺服器的真實 IP，外部網際網路無法解析這些內網網域。

### 二、 運作邏輯：轉發模式 (Forwarding)

內網 DNS 通常扮演「兩面玲瓏」的角色：

1. **內部請求**：如果你找 `nas.local`，它直接翻自己的小本子告訴你 IP。
2. **外部請求**：如果你找 `google.com`，它知道自己處理不了，會將請求**轉發 (Forward)** 給公網 DNS（如 `8.8.8.8`），拿到結果後再轉達給你。

### 三、 常見的實作方式

#### 1. 路由器內建 DNS

大多數家用路由器都有簡易的內網 DNS 功能。當你透過 DHCP 分配 IP 時，路由器會順便記下你的設備名稱。

- **例子**：如果你把電腦改名為 `MyPC`，有時直接在瀏覽器打 `http://MyPC` 就能連上。

#### 2. Windows AD 網域 (Active Directory)

在公司環境中，Windows Server 內建的 DNS 是核心。

- **功能**：所有的員工電腦（如 `PC001.company.com`）都會自動註冊到這台 DNS 上，方便網管遠端管理。

#### 3. 自建輕量級 DNS (如 Pi-hole / AdGuard Home)

這是目前很多進階玩家愛用的方案：

- **Pi-hole**：運行在樹莓派或 NAS 上的軟體。
- **額外功能**：它不只能做內網解析，還能做 **「DNS 攔截」**。當廣告商的域名出現時，它直接回傳「查無此處」，從源頭擋掉全家的廣告。

### 四、 內網網域的命名規範

在內網 DNS 中，你不能亂用 `.com` 或 `.net`（否則會連不到真的網站）。常見的內網專用後綴有：

- **.local**（最常見，但有時會與 mDNS 衝突）
- **.home.arpa**（目前官方建議的家庭內網標準）
- **.lan** 或 **.internal**

### 五、 特殊技術：mDNS (Multicast DNS)

如果你沒有架設專門的 DNS 伺服器，但蘋果設備（AirPlay）或印表機能被找到，那是因為 **mDNS**：

- **原理**：設備在區網內大喊：「我是 `Printer.local`，我的 IP 是 `xxx`！」
- **特點**：不需要伺服器，適合小型環境，但在大型企業網路中會造成過多廣播流量。

## DNS 紀錄
### 一、 基礎設施紀錄 (Infrastructure)

#### 1. A 紀錄 & AAAA 紀錄 (The Mapping)

- **A (Address)**：最核心紀錄，將域名指向 **IPv4** 位址。
- **AAAA (Quad-A)**：將域名指向 **IPv6** 位址。
- **應用**：你的 Homelab 如果有公網 IP，這就是你最常用的紀錄。

#### 2. CNAME 紀錄 (The Alias)

- **定義**：別名紀錄，將一個網域指向「另一個網域」而非 IP。
- **應用場景**：
    - **CDN 服務**：你把 `blog.com` 指向 `cloudflare.com` 的伺服器網址，讓 Cloudflare 幫你處理流量。
    - **縮短維護成本**：如果你的多個子網域（`web`、`api`、`dev`）都跑在同一台主機上，你可以讓它們都 CNAME 到 `home.com`，這樣主機換 IP 時，你只需要改 `home.com` 的 A 紀錄。

### 二、 郵件與通訊紀錄 (Communication)

#### 1. MX 紀錄 (Mail Exchange)

- **定義**：指定負責接收該網域郵件的伺服器。
- **特點**：它有一個 **優先權 (Priority)** 數值，數字越小優先權越高。
- **應用**：如果你想用自訂網域收信（如 `me@yourname.com`），你需要把 MX 指向 Google 或其他郵件服務商。

#### 2. SRV 紀錄 (Service Record)

- **定義**：指定特定服務（如 Minecraft、VoIP）的**主機名與埠號 (Port)**。
- **強大之處**：它是唯一能在 DNS 層級就指定 **Port** 的紀錄！
- **應用**：開 MC 伺服器時，如果你的 Port 不是預設的 `25565`，可以透過 SRV 紀錄讓朋友輸入 `mc.yourname.com` 就直接連進來，不用補上 `:port`。

### 三、 安全與驗證紀錄 (Security & Auth)

#### 1. TXT 紀錄 (Text)

- **定義**：存放一段文字訊息。它不影響導航，但它是網路世界的「證件照」。
- **應用場景**：
    - **所有權驗證**：Google 或 FB 要求你在 DNS 加入一段 TXT 字串，證明你是網域主人。
    - **反垃圾信 (SPF/DKIM)**：在 TXT 紀錄中宣告「只有這幾台伺服器能代表我發信」，防止別人冒用你的網域發詐騙信。

#### 2. CAA 紀錄 (Certificate Authority Authorization)

- **定義**：告訴全世界「只有指定的憑證頒發機構（如 Let's Encrypt）可以幫我的網域發行 SSL 憑證」。
- **應用**：防止駭客透過其他弱點在不知名的發證機構惡意申請你的憑證。

### 四、 進階：指向與轉發的差異

很多人會搞混 **DNS 紀錄** 與 **網址轉發 (URL Redirect)**：
- **CNAME**：是「身分替換」。瀏覽器網址列**不會變**，只是去問另一個地方拿資料。
- **URL Redirect (301/302)**：是「導航跳轉」。瀏覽器網址列**會變**。這不屬於 DNS 範疇，通常是 Web 伺服器做的。

### 五、 外網 DNS 的「同步時間」 (Propagation)

當你在外網改了紀錄，為什麼朋友還連不到？

- **TTL (Time To Live)**：這是最重要的參數。如果 TTL 設為 `3600`，代表全球的 DNS 伺服器會快取你的舊紀錄 1 小時。
- **建議**：如果你準備遷移 Homelab 或換 IP，**請提前一天將 TTL 調低（如 60 或 300）**，這樣正式搬家時，變更才會秒速生效。

### 補充:MC域名
### 第一步：設定 A 紀錄 (建立基礎地標)

首先，你得先讓網域知道 `123.123.123.123` 在哪裡。

- **類型 (Type)**：`A`
- **名稱 (Name/Host)**：`mc-ip` (或者直接用 `mc`，這裡建議先設一個子網域給 SRV 用)
- **內容 (Value/IP)**：`123.123.123.123`
- **TTL**：預設即可 (或 3600)

### 第二步：設定 SRV 紀錄 (處理 Port 號的關鍵)

這是最關鍵的一步，SRV 紀錄會告訴 Minecraft 客戶端：「如果你要找這個網域的 MC 服務，請去某個 IP 的某個 Port」。
在你的 DNS 管理後台（如 Cloudflare, GoDaddy 等），新增一筆紀錄：

- **類型 (Type)**：`SRV`
- **名稱 (Name)**：`mc` (這樣玩家輸入的就是 `mc.tony0202.win`)
- **服務 (Service)**：`_minecraft` (必須加底線)
- **協定 (Protocol)**：`_tcp` (必須加底線)
- **優先權 (Priority)**：`0`
- **權重 (Weight)**：`5`
- **埠號 (Port)**：`25500` (這裡填入你的實際 Port)
- **目標 (Target/Hostname)**：`mc-ip.tony0202.win` (指向你剛才設好的 A 紀錄)